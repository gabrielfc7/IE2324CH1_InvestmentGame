<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stocks · IE 2324 Investment Game</title>
  <link rel="stylesheet" href="../ttu-dark.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let HIST = null, DATA = null;
    async function init(){
      DATA = await (await fetch('stocks.json')).json();
      HIST = await (await fetch('historical.json')).json();
      renderCards();
      drawChart('2024-Fall','AAPL');
      updateQR();
      document.getElementById('semSel').addEventListener('change', updateQR);
      document.getElementById('secSel').addEventListener('change', updateQR);
      document.getElementById('stockSel').addEventListener('change', e=>drawChart(document.getElementById('histSel').value, e.target.value));
      document.getElementById('histSel').addEventListener('change', e=>drawChart(e.target.value, document.getElementById('stockSel').value));
    }
    function updateQR(){
      const sem = document.getElementById('semSel').value;
      const sec = document.getElementById('secSel').value;
      const link = 'invest-portfolio.html?semester='+sem+'&section='+sec;
      const img = document.getElementById('qrimg');
      img.src = 'qr/' + document.getElementById('semSel').value + '_' + document.getElementById('secSel').value + '.png';
      document.getElementById('deepLink').href = link;
      document.getElementById('deepLink').textContent = link;
    }
    function renderCards(){
      const wrap = document.getElementById('cards');
      wrap.innerHTML = '';
      Object.entries(DATA.stocks).forEach(([id,s])=>{
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `<h3>${s.name}</h3>
          <p class="small">${s.sector} · $${s.price}/share</p>
          <p class="small">${s.desc}</p>`;
        wrap.appendChild(div);
      });
      const sel = document.getElementById('stockSel');
      sel.innerHTML = Object.keys(DATA.stocks).map(id=>`<option value="${id}">${id} – ${DATA.stocks[id].name}</option>`).join('');
      document.getElementById('histSel').innerHTML = Object.keys(HIST).map(k=>`<option>${k}</option>`).join('');
    }
    let chart;
    function drawChart(key, id){
      const cfg = HIST[key];
      const series = cfg.series[id];
      const ctx = document.getElementById('stockChart').getContext('2d');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type:'line',
        data:{ labels: cfg.labels, datasets:[{ label: id, data: series, borderWidth:2, fill:false, tension:.2 }] },
        options:{
          plugins:{ legend:{ labels:{ color:'#e7e9ee' } }, title:{ display:true, text:'Historical Price: '+id, color:'#e7e9ee' } },
          scales:{ x:{ title:{ display:true,text:'Month',color:'#a8b0bf' }, ticks:{ color:'#a8b0bf' }, grid:{ color:'#252a34' } }, y:{ title:{ display:true,text:'Price $',color:'#a8b0bf' }, ticks:{ color:'#a8b0bf' }, grid:{ color:'#252a34' } } }
        }
      });
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
<style>html,body{overflow:hidden}</style></head>
<body>

<header>
  <div class="header-inner">
    <div class="brand"><span class="dot"></span><h1>IE 2324 · Investment Game</h1></div>
    <nav>
      <a href="home.html" class="">Home</a>
      <a href="invest-portfolio.html" class="">Portfolio</a>
      <a href="stocks.html" class="active">Stocks</a>
      <a href="dashboard-portfolio.html" class="">Dashboard</a>
      <a href="qr.html" class="">QR Screen</a>
    <a href="historical-all.html">All Charts</a></nav>
  </div>
</header>
<main><div id="fit">
  <section class="card">
    <h2>QR: Join the Game</h2>
    <div class="row">
      <label>Semester</label>
      <select id="semSel"><option>FALL</option><option>SPRING</option></select>
      <label>Section</label>
      <select id="secSel"><option>001</option>
<option>002</option>
<option>003</option>
<option>004</option>
<option>005</option>
<option>D01</option></select>
    </div>
    <div class="qr"><img id="qrimg" width="200" height="200" alt="QR to invest page"></div>
    <p class="small">Deep link: <a id="deepLink" href="#" target="_blank"></a> &nbsp; <span class="small">(QR generated locally)</span></p>
  </section>

  <section class="card">
    <h2>Stocks</h2>
    <div id="cards" class="grid"></div>
  </section>

  <section class="card">
    <h2>Historical Chart</h2>
    <div class="row">
      <label>Semester</label>
      <select id="histSel"></select>
      <label>Stock</label>
      <select id="stockSel"></select>
    </div>
    <div class="chart-wrap"><canvas id="stockChart" height="110"></canvas></div>
  </section>
</div></main>
<script>
  function fitToViewport() {
    const header = document.querySelector('header');
    const footer = document.querySelector('footer');
    const h = window.innerHeight;
    const w = window.innerWidth;
    const availH = h - (header ? header.offsetHeight : 0) - (footer ? footer.offsetHeight : 0) - 8;
    const fit = document.getElementById('fit');
    if (!fit) return;
    fit.style.transform = 'scale(1)';
    fit.style.transformOrigin = 'top left';
    const rect = fit.getBoundingClientRect();
    const scale = Math.min(w / rect.width, availH / rect.height, 1);
    fit.style.transform = 'scale(' + scale + ')';
  }
  window.addEventListener('load', fitToViewport);
  window.addEventListener('resize', fitToViewport);
</script>


<footer>© 2025 IE 2324 · TTU</footer>
</body></html>